# HLA_Assoc

## Introduction
A suite of methods to perform association test. Logistic regression is performed by default.

<br>
<br>

## Usage examples

HLA_assoc in HLA-TAPAS has to be implemented in the directory of main project folder. (i.e. 'HLA-TAPAS/' where 'HLA-TAPAS.py' script is.)

```
$ cd ../ 
# Change your current directory to the HLA-TAPAS main project folder.
```

<br>

### **(1) Logistic Regression**

```
$ python -m HLA_assoc LOGISTIC \
    --vcf HLA_assoc/example/LOGISTIC/IMPUTED.1958BC.bgl.phased.vcf.gz \
    --out MyLogistic/IMPUTED.1958BC \
    --pheno HLA_assoc/example/LOGISTIC/1958BC.phe \
    --pheno-name p1
```

If user wants to make HLA marker have un-transformed allele name, i.e. allele name in *.hped not *.chped, then user can get this by passing '--hped' and '--chped' arguments.

```
$ python -m HLA_assoc LOGISTIC \
    --vcf HLA_assoc/example/LOGISTIC/IMPUTED.1958BC.bgl.phased.vcf.gz \
    --out MyLogistic/IMPUTED.1958BC.rev_map \
    --pheno HLA_assoc/example/LOGISTIC/1958BC.phe \
    --pheno-name p1 \
    --hped HLA_assoc/example/LOGISTIC/1958BC.Ggroup.hped \
    --chped HLA_assoc/example/LOGISTIC/1958BC.imgt3320.4field.chped
```

<br>
<br>

### **(2) Omnibus Test**

Omnibus Test requires next 7 files, each of which contains necessary information for Omnibus Test.

1. (Imputed) Phased BEAGLE file. (*.bgl.phased)
2. PLINK bim file of reference panel. (*.bim)
3. PLINK fam file of target samples. (*.fam)
4. Top 10 Principal Component information generated by PLINK. (*.pcs; with header.)
5. PLINK phenotype file of target samples. (*.pheno; Case: 1/ Control: 0; without header.)
6. Sex information of target samples. (*.sex; without header.)
7. Population information of target samples. (*.pop; without header.)


Assuming 1 - 6 files have the same file prefix and those specified file extensions, those 6 files can be passed to the Omnibus Test **all at once** with the '--file' argument.

<!-- ```
# Under construction. (2020.05.11. WS.)
$ Rscript run_omnibus_test.R --file cohort --pop pop  \
	--out output --aa-only --omnibus \
	--remove-samples-by-haplo \
     	--remove-samples-aa-pattern AA_B \
	--min-haplo-count 10 --maf-threshold 0 
``` -->

```
$ python -m HLA_assoc OMNIBUS \
    --file HLA_assoc/example/OMNIBUS/WTCCC_RA+1000G_EUR_REF.IMPUTED.chr6.hg18.100+100 \
    --pop HLA_assoc/example/OMNIBUS/WTCCC_RA+1000G_EUR_REF.IMPUTED.chr6.hg18.100+100.pop \
    --out MyOmnibus/WTCCC_RA+1000G_EUR_REF.OMNIBUS \
    --aa-only \
    --maf-threshold 0
```

The above command is equivalent to the next command.

```
$ python -m HLA_assoc OMNIBUS \
    --phased HLA_assoc/example/OMNIBUS/WTCCC_RA+1000G_EUR_REF.IMPUTED.chr6.hg18.100+100.bgl.phased \
    --bim HLA_assoc/example/OMNIBUS/WTCCC_RA+1000G_EUR_REF.IMPUTED.chr6.hg18.100+100.bim \
    --fam HLA_assoc/example/OMNIBUS/WTCCC_RA+1000G_EUR_REF.IMPUTED.chr6.hg18.100+100.fam \
    --pcs HLA_assoc/example/OMNIBUS/WTCCC_RA+1000G_EUR_REF.IMPUTED.chr6.hg18.100+100.pcs \
    --pheno HLA_assoc/example/OMNIBUS/WTCCC_RA+1000G_EUR_REF.IMPUTED.chr6.hg18.100+100.pheno \
    --sex HLA_assoc/example/OMNIBUS/WTCCC_RA+1000G_EUR_REF.IMPUTED.chr6.hg18.100+100.sex \
    --pop HLA_assoc/example/OMNIBUS/WTCCC_RA+1000G_EUR_REF.IMPUTED.chr6.hg18.100+100.pop \
    --out MyOmnibus/WTCCC_RA+1000G_EUR_REF.OMNIBUS \
    --aa-only \
    --maf-threshold 0
```

<br>

Or, next minimal 3 files can be passed to perform the Omnibus Test.

1. (Imputed) VCF file generated from SNP2HLA. (*.vcf.gz)
2. PLINK bim file of reference panel. (*.bim)
3. PLINK fam file of target samples. (*.fam)

Phased BEAGLE file and Top 10 PCs will be generated from the given VCF file. PLINK fam file must contain Sex and Phenotype information. All samples will be considered to be originated from same population unless the '--pop' argument is given.

```
$ python -m HLA_assoc OMNIBUS \
    --vcf HLA_assoc/example/OMNIBUS/WTCCC+1000G_EUR_REF.IMPUTED.bgl.phased.vcf.gz \
    --bim HLA_assoc/example/OMNIBUS/WTCCC+1000G_EUR_REF.REF.bglv4.bim \
    --fam HLA_assoc/example/OMNIBUS/wtccc_filtered_58C_RA.hatk.300+300.chr6.hg18.fam \
    --pheno HLA_assoc/example/OMNIBUS/wtccc_filtered_58C_RA.hatk.300+300.phe \
    --out MyOmnibus_minimal/WTCCC_RA+1000G_EUR_REF.OMNIBUS \
    --aa-only \
    --maf-threshold 0
```

<!-- <br>

```
$ python -m HLA_assoc OMNIBUS \
    --vcf HLA_assoc/example/OMNIBUS/1958BC+HM_CEU_REF.IMPUTED.bgl.phased.vcf.gz \
    --bim HLA_assoc/example/OMNIBUS/1958BC+HM_CEU_REF.REF.bglv4.bim \
    --fam HLA_assoc/example/OMNIBUS/1958BC.fam \
    --pheno HLA_assoc/example/OMNIBUS/1958BC.phe \
    --out MyOmnibus_minimal/1958BC+HM_CEU_REF.minimal_input.OMNIBUS \
    --aa-only \
    --maf-threshold 0
``` -->